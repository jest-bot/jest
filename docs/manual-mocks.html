<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Manual Mocks · Jest</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Manual Mocks · Jest"><meta property="og:type" content="website"><meta property="og:url" content="https://facebook.github.io/jest/index.html"><meta property="og:image" content="https://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="Manual mocks are used to stub out functionality with mock data. For example, instead of accessing a remote resource like a website or a database, you might want to create a manual mock that allows you to use fake data. This ensures your tests will be fast and not flaky."><link rel="alternate" type="application/atom+xml" href="/jest/blog/atom.xml" title="Jest Blog ATOM Feed"><link rel="alternate" type="application/rss+xml" href="/jest/blog/feed.xml" title="Jest Blog RSS Feed"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="stylesheet" href="/jest/css/jest.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><div class="navSlideout"><i class="menuExpand"><span></span><span></span><span></span></i></div><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/getting-started.html" class="active">Docs</a></li><li><a href="/jest/help.html" class="">Help</a></li><li><a href="/jest/blog/" class="">Blog</a></li><li><a href="https://github.com/facebook/jest" class="">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input id="search_input_react" type="text" placeholder="Search"></li></ul></nav><script>
          var triggers = document.getElementsByClassName('menuExpand');
          var navs = document.getElementsByClassName('navSlideout');
          for (var i=0; i < triggers.length; i++) {
            triggers[i].onclick = function() {
              for (var j=0; j < navs.length; j++) {
                navs[j].classList.toggle('navSlideoutActive');
                navs[j].nextSibling.classList.toggle('slidingNavActive');
              }
            };
          }
        </script></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><a href="/jest/docs/getting-started.html">Docs</a><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-async.html#content">Async Tests</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/mock-functions.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/timer-mocks.html#content">Timer Mocks</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-react.html#content">Testing React Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-react-native.html#content">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-jquery.html#content">DOM Manipulation</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/manual-mocks.html#content">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-webpack.html#content">Webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/migration-guide.html#content">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/troubleshooting.html#content">Troubleshooting</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/api.html#content">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/expect.html#content">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/mock-function-api.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/jest-object.html#content">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/configuration.html#content">Configuring package.json</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/cli.html#content">Jest CLI Options</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer documentContainer postContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link" href="https://github.com/facebook/jest/edit/master/docs/ManualMocks.md" target="_blank">Edit on GitHub</a><h1>Manual Mocks</h1></header><article><div><p>Manual mocks are used to stub out functionality with mock data. For example, instead of accessing a remote resource like a website or a database, you might want to create a manual mock that allows you to use fake data. This ensures your tests will be fast and not flaky.</p><p>Manual mocks are defined by writing a module in a <code>__mocks__/</code> subdirectory
immediately adjacent to the module. For example, to mock a module called
<code>user</code> in the <code>models</code> directory, create a file called <code>user.js</code> and
put it in the <code>models/__mocks__</code> directory. If the module you are mocking is
a node module (eg: <code>fs</code>), the mock should be placed in the same parent
directory as the <code>node_modules</code> folder. Eg:</p><pre class="prism language-javascript">
  node_modules
  __mocks__
    fs<span class="token punctuation">.</span>js
  __tests__
  models
    __mocks__
      user<span class="token punctuation">.</span>js
    user<span class="token punctuation">.</span>js
  views
  config</pre><p>When a manual mock exists for a given module, Jest&#x27;s module system will use that module when explicitly calling <code>jest.mock(&#x27;moduleName&#x27;)</code>.</p><p>Here&#x27;s a contrived example where we have a module that provides a summary of
all the files in a given directory.</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// FileSummarizer.js</span>
<span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">summarizeFilesInDirectorySync</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fileName <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    fileName<span class="token punctuation">,</span>
    directory<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>summarizeFilesInDirectorySync <span class="token operator">=</span> summarizeFilesInDirectorySync<span class="token punctuation">;</span></pre><p>Since we&#x27;d like our tests to avoid actually hitting the disk (that&#x27;s pretty
slow and fragile), we create a manual mock for the <code>fs</code> module by extending an
automatic mock. Our manual mock will implement custom versions of the <code>fs</code> APIs
that we can build on for our tests:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// __mocks__/fs.js</span>
<span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">genMockFromModule</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// This is a custom function that our tests can use during setup to specify</span>
<span spellcheck="true" class="token comment">// what the files on the &quot;mock&quot; filesystem should look like when any of the</span>
<span spellcheck="true" class="token comment">// `fs` APIs are used.</span>
<span class="token keyword">let</span> mockFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">__setMockFiles</span><span class="token punctuation">(</span>newMockFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mockFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">in</span> newMockFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span spellcheck="true" class="token comment">// A custom version of `readdirSync` that reads from the special mocked out</span>
<span spellcheck="true" class="token comment">// file list set via __setMockFiles</span>
<span class="token keyword">function</span> <span class="token function">readdirSync</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> mockFiles<span class="token punctuation">[</span>directoryPath<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

fs<span class="token punctuation">.</span>__setMockFiles <span class="token operator">=</span> __setMockFiles<span class="token punctuation">;</span>
fs<span class="token punctuation">.</span>readdirSync <span class="token operator">=</span> readdirSync<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> fs<span class="token punctuation">;</span></pre><p>Now we write our test:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// __tests__/FileSummarizer-test.js</span>
<span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;listFilesInDirectorySync&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> MOCK_FILE_INFO <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#x27;/path/to/file1.js&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;console.log(&quot;file1 contents&quot;);&#x27;</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;/path/to/file2.txt&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;file2 contents&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// Set up some mocked out file info before each test</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__setMockFiles</span><span class="token punctuation">(</span>MOCK_FILE_INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;includes all files in the directory in the summary&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> FileSummarizer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../FileSummarizer&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fileSummary <span class="token operator">=</span> FileSummarizer<span class="token punctuation">.</span><span class="token function">summarizeFilesInDirectorySync</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;/path/to&#x27;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>fileSummary<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>The example mock shown here uses <a href="/jest/docs/api.html#jestgenmockfrommodulemodulename" target=""><code>jest.genMockFromModule</code></a>
to generate an automatic mock, and overrides its default behavior. This is the
recommended approach, but is completely optional. If you do not want to use the
automatic mock at all, you can simply export your own functions from the mock
file. One downside to fully manual mocks is that they&#x27;re manual –
meaning you have to manually update them any time the module they are mocking
changes. Because of this, it&#x27;s best to use or extend the automatic mock when it
works for your needs.</p><p>To ensure that a manual mock and its real implementation stay in sync, it might be useful to require the real module using <code>require.requireActual(moduleName)</code> in your manual mock and amending it with mock functions before exporting it.</p><p>The code for this example is available at
<a href="https://github.com/facebook/jest/tree/master/examples/manual_mocks" target="_blank">examples/manual_mocks</a>.</p></div></article></div><div class="docs-prevnext"><a class="docs-next" href="tutorial-webpack.html#content">Next →</a></div></div></div></div><div class="footerContainer"><div class="wrapper footerWrapper"><div class="footerBlocks"><div class="footerSection fbOpenSourceFooter"><svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px"><g><path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z"></path><path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z"></path><path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z"></path></g></svg><h2>Facebook Open Source</h2></div><div class="footerSection"><a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">Open Source Projects</a><a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a><a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a></div><div class="footerSection rightAlign"><a class="footerLink" href="https://github.com/facebook/jest" target="_blank">Contribute on GitHub</a></div></div></div></div></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-44373548-17', 'auto');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            docsearch({
              apiKey: '833906d7486e4059359fa58823c4ef56',
              indexName: 'jest',
              inputSelector: '#search_input_react'
            });
          </script><script async defer src="https://buttons.github.io/buttons.js"></script></body></html>